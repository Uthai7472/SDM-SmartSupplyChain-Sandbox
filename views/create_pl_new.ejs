<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
      .topic {
        /* display: flex;
            justify-content: center;
            align-items: center;
            border: 3px solid red; */
      }
      .main_form {
        display: flex;
        justify-content: space-between;
        /* align-items: center; */
        margin: 3px 3px;
        width: auto;
        height: 50vh;
        /* border: 1px solid gray;
            border-radius: 10px 10px; */
      }
      .left_form {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        /* align-items: center; */
        width: 49%;
        height: 50vh;
        /* border: 3px solid red; */
        border: 1px solid gray;
        border-radius: 10px 10px;
        padding-bottom: 5px;
      }
      .right-form {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 49%;
        height: auto;
        /* border: 3px solid red; */
        border: 1px solid gray;
        border-radius: 10px 10px;
      }
      .left_form_topic {
        display: flex;
        justify-content: center;
        align-items: center;
        /* border: 1px solid gray; */
        height: 8vh;
        /* padding: 3px 3px; */
      }
      .left_form_container {
        display: flex;

        /* justify-content: flex-start;
            align-items: center; */
        width: auto;
        height: 42vh;
        padding-left: 10px;
        padding-right: 10px;
        /* border: 1px solid red; */
      }
      .left_form_btn {
        display: flex;
        justify-content: center;
        width: auto;
        /* border: 1px solid red; */
      }
      .table input{
        width: 80%;
      }
    </style>
  </head>
  <body>
    <%- include('sub_views/header') %>

    <div class="topic">
      <h1>Create Packing List</h1>
    </div>

    <div class="main_form" id="main_form">
      <div class="left_form" id="left_form">
        <div class="left_form_topic">
          <h3>DNTH (Request/pcs.)</h3>
        </div>
        <div class="left_form_container">
          <table class="table">
            <thead>
              <tr>
                <th>P/N</th>
                <th>Box</th>
                <th>Pcs.</th>
              </tr>
            </thead>
            <tbody>
              <form action="/create_pl_new/update" method="POST">
                <% shop_datas.forEach((shop_data, index) => { %>
                <tr>
                    <td>
                    <input
                        type="text"
                        name="dnth_partNumber[]"
                        id="dnth_partNumber_<%= index %>"
                        value="<%= shop_data.partNumber %>"
                        readonly
                    />
                    </td>
                    <td>
                    <input
                        type="number"
                        name="shop_box[]"
                        id="shop_box_<%= index %>"
                        value="0"
                        onchange="updateShopQty(this.value, <%= shop_data.qty_kanban_in %>, <%= shop_data.total_ok %>,<%= shop_data.box_qty %>, <%= index %>)"
                    />
                    /<%= shop_data.box_qty
                    %>
                    </td>
                    <td>
                    <input
                        type="number"
                        name="shop_qty[]"
                        id="shop_qty_<%= index %>"
                        value="0"
                        readonly
                    />
                    /<%= shop_data.total_ok %>
                    </td>
                </tr>
                <% }) %>
                
            
            </tbody>
          </table>
        </div>
        <div class="left_form_btn">
            <button type="submit" class="btn btn-success" id="dnth_submit" name="dnth_submit">Submit</button>
        </div>
        </form>
      </div>

      <div class="right-form" id="right-form"></div>
    </div>

    <script>
      function updateShopQty(shopBoxValue, qtyKanbanInValue, totalOkValue, boxQtyValue, index) {
        const shopBoxInput = document.getElementById("shop_box_" + index);
        const shopQtyInput = document.getElementById("shop_qty_" + index);
        if (shopBoxValue < 0 || shopBoxValue > boxQtyValue) {
            shopBoxInput.value = 0;
            shopQtyInput.value = 0;
        } else {
            const shopQtyValue = qtyKanbanInValue * shopBoxValue;
            if (shopQtyValue >= totalOkValue) {
                shopQtyInput.value = totalOkValue;
            } else {
                shopQtyInput.value = shopQtyValue;
            }
        }
      }
    </script>
  </body>
</html>
